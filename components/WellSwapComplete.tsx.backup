'use client';

import React, { useState, useEffect } from 'react';
import { Calculator, TrendingUp, Shield, FileText, DollarSign, Clock, AlertTriangle, CheckCircle, Upload, Wallet, Users, ArrowRight, Globe, Settings } from 'lucide-react';

const WellSwapGlobalInsuranceValuationSystem = () => {
  // ì–¸ì–´ ìƒíƒœ ê´€ë¦¬
  const [currentLanguage, setCurrentLanguage] = useState('en');
  const [userRole, setUserRole] = useState(null); // 'admin' | 'user' | null
  
  // ì–¸ì–´íŒ© ì •ì˜
  const languages = {
    en: {
      title: "WellSwap Global Insurance Asset Valuation System",
      subtitle: "Precise asset valuation considering dividend yields and principal recovery periods",
      connectWallet: "Connect Wallet",
      walletConnected: "Wallet Connected Successfully",
      tradingFlow: "Trading Flow",
      insuranceInfo: "Insurance Information",
      policyType: "Policy Type", 
      company: "Insurance Company",
      policyNumber: "Policy Number",
      premiumAmount: "Annual Premium (USD)",
      policyTerm: "Policy Term (Years)",
      yearsElapsed: "Years Elapsed",
      guaranteedReturn: "Guaranteed Return (%)",
      nonGuaranteedReturn: "Non-guaranteed Return (%)",
      startAnalysis: "Start Web Search + AI Analysis",
      analysisInProgress: "ğŸ” Web Search & ğŸ¤– AI Analysis in Progress...",
      realTimeProgress: "Real-time Analysis Progress",
      webSearchProgress: "Collecting real-time market data via web search...",
      aiAnalysisProgress: "Performing value inference analysis using AI machine learning...",
      regulatoryProgress: "Verifying Hong Kong regulatory data...",
      comprehensiveEval: "Comprehensive Evaluation Results",
      aiMachineLearning: "AI Machine Learning Analysis Results",
      aiConfidence: "AI Confidence",
      riskScore: "Risk Score",
      aiRecommendation: "AI Recommendation Grade",
      aiKeyFactors: "AI Key Analysis Factors",
      realTimeMarketData: "Real-time Market Data",
      actualSolvencyRatio: "Actual Solvency Ratio",
      actualDividendRate: "Actual Dividend Performance",
      actualCreditRating: "Actual Credit Rating",
      marketTrends: "Real-time Market Trends",
      lastUpdated: "Last Updated",
      currentValueAnalysis: "Current Value Analysis",
      totalPremiumPaid: "Total Premium Paid",
      guaranteedValue: "Guaranteed Value",
      dividendIncludedValue: "Dividend-included Value",
      currentSurrenderValue: "Current Surrender Value",
      futureValueProjection: "Maturity Value Projection",
      maturityGuaranteedValue: "Maturity Guaranteed Value",
      maturityTotalValue: "Maturity Total Value",
      expectedMaturityReturn: "Expected Maturity Return",
      annualizedReturn: "Annualized Return (IRR)",
      hongKongRegulatory: "Hong Kong Regulatory Compliance Status",
      iaApproval: "IA (Insurance Authority) Approval",
      normal: "âœ“ Normal",
      solvencyRatio: "Solvency Ratio",
      iaisCompliance: "IAIS Global Standards Compliance",
      compliant: "âœ“ Compliant",
      dividendPerformance: "Dividend Performance (Recent 5 Years)",
      actuarialAnalysis: "Professional Actuarial Analysis",
      cashValueMultiple: "Cash Value Multiple",
      dividendValueRatio: "Dividend Value Ratio",
      actuarialOpinion: "Actuarial Opinion",
      marketTrendAnalysis: "Hong Kong Insurance Market Trends",
      riskFactors: "Risk Factors",
      riskWarning: "Risk Warning",
      attention: "Attention",
      wholeLife: "Whole Life Insurance",
      endowment: "Savings Insurance", 
      annuity: "Annuity Insurance",
      investment: "Investment-linked Insurance",
      selectOption: "Select an option",
      exampleCompanies: "e.g., AXA, Prudential, AIA, FWD",
      enterPolicyNumber: "Enter policy number",
      payFee: "Pay Fee (0.1 BNB)",
      contractRegistration: "Smart Contract Registration",
      registrationComplete: "Registration Complete",
      buyerMatching: "Buyer Matching in Progress",
      matchingDescription: "The platform is finding suitable buyers. You will be notified when matching is complete.",
      adminDashboard: "Admin Dashboard",
      userDashboard: "User Dashboard",
      globalPlatform: "Global Insurance Asset Trading Platform"
    },
    ko: {
      title: "WellSwap ê¸€ë¡œë²Œ ë³´í—˜ ìì‚° ê°€ì¹˜ í‰ê°€ ì‹œìŠ¤í…œ",
      subtitle: "ë°°ë‹¹ ìˆ˜ìµê³¼ ì›ê¸ˆ íšŒë³µ ê¸°ê°„ì„ ê³ ë ¤í•œ ì •ë°€í•œ ìì‚° ê°€ì¹˜ í‰ê°€",
      connectWallet: "ì§€ê°‘ ì—°ê²°",
      walletConnected: "ì§€ê°‘ì´ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤",
      tradingFlow: "ê±°ë˜ í”Œë¡œìš°",
      insuranceInfo: "ë³´í—˜ ì •ë³´ ì…ë ¥",
      policyType: "ë³´í—˜ ì¢…ë¥˜",
      company: "ë³´í—˜íšŒì‚¬",
      policyNumber: "ì¦ê¶Œë²ˆí˜¸",
      premiumAmount: "ì—°ê°„ ë³´í—˜ë£Œ (USD)",
      policyTerm: "ë‚©ì…ê¸°ê°„ (ë…„)",
      yearsElapsed: "ê²½ê³¼ë…„ìˆ˜",
      guaranteedReturn: "ë³´ì¥ ìˆ˜ìµë¥  (%)",
      nonGuaranteedReturn: "ë¹„ë³´ì¥ ìˆ˜ìµë¥  (%)",
      startAnalysis: "ì‹¤ì œ ì›¹ê²€ìƒ‰ + AI ë¶„ì„ ì‹œì‘",
      analysisInProgress: "ğŸ” ì›¹ ê²€ìƒ‰ & ğŸ¤– AI ë¶„ì„ ì§„í–‰ ì¤‘...",
      realTimeProgress: "ì‹¤ì‹œê°„ ë¶„ì„ ì§„í–‰ ìƒí™©",
      webSearchProgress: "ì›¹ ê²€ìƒ‰ì„ í†µí•œ ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...",
      aiAnalysisProgress: "AI ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ í™œìš©í•œ ê°€ì¹˜ ì¶”ë¡  ë¶„ì„ ì¤‘...",
      regulatoryProgress: "í™ì½© ë³´í—˜ê°ë…êµ­ ê·œì œ ë°ì´í„° ê²€ì¦ ì¤‘...",
      comprehensiveEval: "ì¢…í•© í‰ê°€ ê²°ê³¼",
      aiMachineLearning: "AI ë¨¸ì‹ ëŸ¬ë‹ ë¶„ì„ ê²°ê³¼",
      aiConfidence: "AI ì‹ ë¢°ë„",
      riskScore: "ë¦¬ìŠ¤í¬ ì ìˆ˜",
      aiRecommendation: "AI ì¶”ì²œ ë“±ê¸‰",
      aiKeyFactors: "AI í•µì‹¬ ë¶„ì„ ìš”ì¸",
      realTimeMarketData: "ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„°",
      actualSolvencyRatio: "ì‹¤ì œ ì†”ë²¤ì‹œ ë¹„ìœ¨",
      actualDividendRate: "ì‹¤ì œ ë°°ë‹¹ ì´í–‰ë¥ ",
      actualCreditRating: "ì‹¤ì œ ì‹ ìš©ë“±ê¸‰",
      marketTrends: "ì‹¤ì‹œê°„ ì‹œì¥ ë™í–¥",
      lastUpdated: "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸",
      currentValueAnalysis: "í˜„ì¬ ê°€ì¹˜ ë¶„ì„",
      totalPremiumPaid: "ì´ ë‚©ì… ë³´í—˜ë£Œ",
      guaranteedValue: "ë³´ì¥ ìˆ˜ìµ ê°€ì¹˜",
      dividendIncludedValue: "ë°°ë‹¹ í¬í•¨ ê°€ì¹˜",
      currentSurrenderValue: "í˜„ì¬ í•´ì•½ í™˜ê¸‰ê¸ˆ",
      futureValueProjection: "ë§Œê¸° ì˜ˆìƒ ê°€ì¹˜",
      maturityGuaranteedValue: "ë§Œê¸° ë³´ì¥ ê°€ì¹˜",
      maturityTotalValue: "ë§Œê¸° ì˜ˆìƒ ì´ê°€ì¹˜",
      expectedMaturityReturn: "ì˜ˆìƒ ë§Œê¸° ìˆ˜ìµë¥ ",
      annualizedReturn: "ì—°í™˜ì‚° ìˆ˜ìµë¥  (IRR)",
      hongKongRegulatory: "í™ì½© ê·œì œ ì¤€ìˆ˜ í˜„í™©",
      iaApproval: "í™ì½© ë³´í—˜ê°ë…êµ­(IA) ì¸ê°€",
      normal: "âœ“ ì •ìƒ",
      solvencyRatio: "ì†”ë²¤ì‹œ ë¹„ìœ¨",
      iaisCompliance: "IAIS ê¸€ë¡œë²Œ ê¸°ì¤€ ì¤€ìˆ˜",
      compliant: "âœ“ ì¤€ìˆ˜",
      dividendPerformance: "ë°°ë‹¹ ì´í–‰ë¥  (ìµœê·¼ 5ë…„)",
      actuarialAnalysis: "ê³„ë¦¬ì‚¬ ì „ë¬¸ ë¶„ì„",
      cashValueMultiple: "í˜„ê¸ˆê°€ì¹˜ ë°°ìœ¨",
      dividendValueRatio: "ë°°ë‹¹ ê°€ì¹˜ ë¹„ì¤‘",
      actuarialOpinion: "ê³„ë¦¬ì‚¬ ì˜ê²¬",
      marketTrendAnalysis: "í™ì½© ë³´í—˜ ì‹œì¥ ë™í–¥",
      riskFactors: "ë¦¬ìŠ¤í¬ ìš”ì¸",
      riskWarning: "ì£¼ì˜ì‚¬í•­",
      attention: "ì£¼ì˜ì‚¬í•­",
      wholeLife: "ì¢…ì‹ ë³´í—˜",
      endowment: "ì €ì¶•ë³´í—˜",
      annuity: "ì—°ê¸ˆë³´í—˜",
      investment: "íˆ¬ìì—°ê³„ë³´í—˜",
      selectOption: "ì„ íƒí•˜ì„¸ìš”",
      exampleCompanies: "ì˜ˆ: AXA, Prudential, AIA, FWD",
      enterPolicyNumber: "ì¦ê¶Œë²ˆí˜¸ ì…ë ¥",
      payFee: "ìˆ˜ìˆ˜ë£Œ ì§€ë¶ˆ (0.1 BNB)",
      contractRegistration: "ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë“±ë¡",
      registrationComplete: "ë“±ë¡ ì™„ë£Œ",
      buyerMatching: "ë§¤ìˆ˜ì ë§¤ì¹­ ëŒ€ê¸° ì¤‘",
      matchingDescription: "í”Œë«í¼ì—ì„œ ì í•©í•œ ë§¤ìˆ˜ìë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤. ë§¤ì¹­ ì™„ë£Œ ì‹œ ì•Œë¦¼ì„ ë°›ê²Œ ë©ë‹ˆë‹¤.",
      adminDashboard: "ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ",
      userDashboard: "ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ",
      globalPlatform: "ê¸€ë¡œë²Œ ë³´í—˜ ìì‚° ê±°ë˜ í”Œë«í¼"
    },
    zh: {
      title: "WellSwap å…¨çƒä¿é™©èµ„äº§ä»·å€¼è¯„ä¼°ç³»ç»Ÿ",
      subtitle: "è€ƒè™‘è‚¡æ¯æ”¶ç›Šå’Œæœ¬é‡‘å›æ”¶æœŸçš„ç²¾ç¡®èµ„äº§ä»·å€¼è¯„ä¼°",
      connectWallet: "è¿æ¥é’±åŒ…",
      walletConnected: "é’±åŒ…è¿æ¥æˆåŠŸ",
      tradingFlow: "äº¤æ˜“æµç¨‹",
      insuranceInfo: "ä¿é™©ä¿¡æ¯è¾“å…¥",
      policyType: "ä¿é™©ç±»å‹",
      company: "ä¿é™©å…¬å¸",
      policyNumber: "ä¿å•å·ç ",
      premiumAmount: "å¹´åº¦ä¿è´¹ (USD)",
      policyTerm: "ç¼´è´¹æœŸé—´ (å¹´)",
      yearsElapsed: "å·²è¿‡å¹´æ•°",
      guaranteedReturn: "ä¿è¯æ”¶ç›Šç‡ (%)",
      nonGuaranteedReturn: "éä¿è¯æ”¶ç›Šç‡ (%)",
      startAnalysis: "å¼€å§‹ç½‘ç»œæœç´¢ + AI åˆ†æ",
      analysisInProgress: "ğŸ” ç½‘ç»œæœç´¢ & ğŸ¤– AI åˆ†æè¿›è¡Œä¸­...",
      realTimeProgress: "å®æ—¶åˆ†æè¿›åº¦",
      webSearchProgress: "é€šè¿‡ç½‘ç»œæœç´¢æ”¶é›†å®æ—¶å¸‚åœºæ•°æ®ä¸­...",
      aiAnalysisProgress: "ä½¿ç”¨AIæœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œä»·å€¼æ¨ç†åˆ†æä¸­...",
      regulatoryProgress: "éªŒè¯é¦™æ¸¯ç›‘ç®¡æ•°æ®ä¸­...",
      comprehensiveEval: "ç»¼åˆè¯„ä¼°ç»“æœ",
      aiMachineLearning: "AIæœºå™¨å­¦ä¹ åˆ†æç»“æœ",
      aiConfidence: "AIç½®ä¿¡åº¦",
      riskScore: "é£é™©è¯„åˆ†",
      aiRecommendation: "AIæ¨èç­‰çº§",
      aiKeyFactors: "AIå…³é”®åˆ†æå› ç´ ",
      realTimeMarketData: "å®æ—¶å¸‚åœºæ•°æ®",
      actualSolvencyRatio: "å®é™…å¿ä»˜èƒ½åŠ›æ¯”ç‡",
      actualDividendRate: "å®é™…è‚¡æ¯å±¥è¡Œç‡",
      actualCreditRating: "å®é™…ä¿¡ç”¨è¯„çº§",
      marketTrends: "å®æ—¶å¸‚åœºè¶‹åŠ¿",
      lastUpdated: "æœ€åæ›´æ–°",
      currentValueAnalysis: "å½“å‰ä»·å€¼åˆ†æ",
      totalPremiumPaid: "æ€»ç¼´ä¿è´¹",
      guaranteedValue: "ä¿è¯æ”¶ç›Šä»·å€¼",
      dividendIncludedValue: "å«è‚¡æ¯ä»·å€¼",
      currentSurrenderValue: "å½“å‰é€€ä¿ä»·å€¼",
      futureValueProjection: "åˆ°æœŸé¢„æœŸä»·å€¼",
      maturityGuaranteedValue: "åˆ°æœŸä¿è¯ä»·å€¼",
      maturityTotalValue: "åˆ°æœŸé¢„æœŸæ€»ä»·å€¼",
      expectedMaturityReturn: "é¢„æœŸåˆ°æœŸæ”¶ç›Šç‡",
      annualizedReturn: "å¹´åŒ–æ”¶ç›Šç‡ (IRR)",
      hongKongRegulatory: "é¦™æ¸¯ç›‘ç®¡åˆè§„çŠ¶å†µ",
      iaApproval: "ä¿é™©ä¸šç›‘ç®¡å±€(IA)è®¸å¯",
      normal: "âœ“ æ­£å¸¸",
      solvencyRatio: "å¿ä»˜èƒ½åŠ›æ¯”ç‡",
      iaisCompliance: "IAISå…¨çƒæ ‡å‡†åˆè§„",
      compliant: "âœ“ åˆè§„",
      dividendPerformance: "è‚¡æ¯å±¥è¡Œç‡ (è¿‘5å¹´)",
      actuarialAnalysis: "ä¸“ä¸šç²¾ç®—åˆ†æ",
      cashValueMultiple: "ç°é‡‘ä»·å€¼å€æ•°",
      dividendValueRatio: "è‚¡æ¯ä»·å€¼æ¯”é‡",
      actuarialOpinion: "ç²¾ç®—å¸ˆæ„è§",
      marketTrendAnalysis: "é¦™æ¸¯ä¿é™©å¸‚åœºè¶‹åŠ¿",
      riskFactors: "é£é™©å› ç´ ",
      riskWarning: "æ³¨æ„äº‹é¡¹",
      attention: "æ³¨æ„äº‹é¡¹",
      wholeLife: "ç»ˆèº«ä¿é™©",
      endowment: "å‚¨è“„ä¿é™©",
      annuity: "å¹´é‡‘ä¿é™©",
      investment: "æŠ•èµ„è¿ç»“ä¿é™©",
      selectOption: "è¯·é€‰æ‹©",
      exampleCompanies: "ä¾‹å¦‚: AXA, Prudential, AIA, FWD",
      enterPolicyNumber: "è¾“å…¥ä¿å•å·ç ",
      payFee: "æ”¯ä»˜è´¹ç”¨ (0.1 BNB)",
      contractRegistration: "æ™ºèƒ½åˆçº¦æ³¨å†Œ",
      registrationComplete: "æ³¨å†Œå®Œæˆ",
      buyerMatching: "ä¹°å®¶åŒ¹é…ä¸­",
      matchingDescription: "å¹³å°æ­£åœ¨å¯»æ‰¾åˆé€‚çš„ä¹°å®¶ã€‚åŒ¹é…å®Œæˆæ—¶æ‚¨å°†æ”¶åˆ°é€šçŸ¥ã€‚",
      adminDashboard: "ç®¡ç†å‘˜ä»ªè¡¨æ¿",
      userDashboard: "ç”¨æˆ·ä»ªè¡¨æ¿",
      globalPlatform: "å…¨çƒä¿é™©èµ„äº§äº¤æ˜“å¹³å°"
    },
    ja: {
      title: "WellSwap ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¿é™ºè³‡ç”£ä¾¡å€¤è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ",
      subtitle: "é…å½“åç›Šã¨å…ƒæœ¬å›åæœŸé–“ã‚’è€ƒæ…®ã—ãŸç²¾å¯†ãªè³‡ç”£ä¾¡å€¤è©•ä¾¡",
      connectWallet: "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶š",
      walletConnected: "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šæˆåŠŸ",
      tradingFlow: "å–å¼•ãƒ•ãƒ­ãƒ¼",
      insuranceInfo: "ä¿é™ºæƒ…å ±å…¥åŠ›",
      policyType: "ä¿é™ºç¨®é¡",
      company: "ä¿é™ºä¼šç¤¾",
      policyNumber: "è¨¼åˆ¸ç•ªå·",
      premiumAmount: "å¹´é–“ä¿é™ºæ–™ (USD)",
      policyTerm: "æ‰•è¾¼æœŸé–“ (å¹´)",
      yearsElapsed: "çµŒéå¹´æ•°",
      guaranteedReturn: "ä¿è¨¼åˆ©å›ã‚Š (%)",
      nonGuaranteedReturn: "éä¿è¨¼åˆ©å›ã‚Š (%)",
      startAnalysis: "Webæ¤œç´¢ + AIåˆ†æé–‹å§‹",
      analysisInProgress: "ğŸ” Webæ¤œç´¢ & ğŸ¤– AIåˆ†æé€²è¡Œä¸­...",
      realTimeProgress: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æé€²æ—",
      webSearchProgress: "Webæ¤œç´¢ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¸‚å ´ãƒ‡ãƒ¼ã‚¿åé›†ä¸­...",
      aiAnalysisProgress: "AIæ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’æ´»ç”¨ã—ãŸä¾¡å€¤æ¨è«–åˆ†æä¸­...",
      regulatoryProgress: "é¦™æ¸¯è¦åˆ¶ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ä¸­...",
      comprehensiveEval: "ç·åˆè©•ä¾¡çµæœ",
      aiMachineLearning: "AIæ©Ÿæ¢°å­¦ç¿’åˆ†æçµæœ",
      aiConfidence: "AIä¿¡é ¼åº¦",
      riskScore: "ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢",
      aiRecommendation: "AIæ¨å¥¨ã‚°ãƒ¬ãƒ¼ãƒ‰",
      aiKeyFactors: "AIä¸»è¦åˆ†æè¦å› ",
      realTimeMarketData: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¸‚å ´ãƒ‡ãƒ¼ã‚¿",
      actualSolvencyRatio: "å®Ÿéš›ã®ã‚½ãƒ«ãƒ™ãƒ³ã‚·ãƒ¼æ¯”ç‡",
      actualDividendRate: "å®Ÿéš›ã®é…å½“å±¥è¡Œç‡",
      actualCreditRating: "å®Ÿéš›ã®ä¿¡ç”¨æ ¼ä»˜ã‘",
      marketTrends: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¸‚å ´å‹•å‘",
      lastUpdated: "æœ€çµ‚æ›´æ–°",
      currentValueAnalysis: "ç¾åœ¨ä¾¡å€¤åˆ†æ",
      totalPremiumPaid: "ç·æ‰•è¾¼ä¿é™ºæ–™",
      guaranteedValue: "ä¿è¨¼åç›Šä¾¡å€¤",
      dividendIncludedValue: "é…å½“è¾¼ã¿ä¾¡å€¤",
      currentSurrenderValue: "ç¾åœ¨ã®è§£ç´„è¿”æˆ»é‡‘",
      futureValueProjection: "æº€æœŸäºˆæƒ³ä¾¡å€¤",
      maturityGuaranteedValue: "æº€æœŸä¿è¨¼ä¾¡å€¤",
      maturityTotalValue: "æº€æœŸäºˆæƒ³ç·ä¾¡å€¤",
      expectedMaturityReturn: "äºˆæƒ³æº€æœŸåç›Šç‡",
      annualizedReturn: "å¹´ç‡æ›ç®—åç›Šç‡ (IRR)",
      hongKongRegulatory: "é¦™æ¸¯è¦åˆ¶éµå®ˆçŠ¶æ³",
      iaApproval: "ä¿é™ºæ¥­ç›£ç†å‡¦(IA)èªå¯",
      normal: "âœ“ æ­£å¸¸",
      solvencyRatio: "ã‚½ãƒ«ãƒ™ãƒ³ã‚·ãƒ¼æ¯”ç‡",
      iaisCompliance: "IAISã‚°ãƒ­ãƒ¼ãƒãƒ«åŸºæº–éµå®ˆ",
      compliant: "âœ“ éµå®ˆ",
      dividendPerformance: "é…å½“å±¥è¡Œç‡ (ç›´è¿‘5å¹´)",
      actuarialAnalysis: "å°‚é–€ã‚¢ã‚¯ãƒãƒ¥ã‚¢ãƒªãƒ¼åˆ†æ",
      cashValueMultiple: "ç¾é‡‘ä¾¡å€¤å€ç‡",
      dividendValueRatio: "é…å½“ä¾¡å€¤æ¯”é‡",
      actuarialOpinion: "ã‚¢ã‚¯ãƒãƒ¥ã‚¢ãƒªãƒ¼æ„è¦‹",
      marketTrendAnalysis: "é¦™æ¸¯ä¿é™ºå¸‚å ´å‹•å‘",
      riskFactors: "ãƒªã‚¹ã‚¯è¦å› ",
      riskWarning: "æ³¨æ„äº‹é …",
      attention: "æ³¨æ„äº‹é …",
      wholeLife: "çµ‚èº«ä¿é™º",
      endowment: "è²¯è“„ä¿é™º",
      annuity: "å¹´é‡‘ä¿é™º",
      investment: "æŠ•è³‡å‹ä¿é™º",
      selectOption: "é¸æŠã—ã¦ãã ã•ã„",
      exampleCompanies: "ä¾‹: AXA, Prudential, AIA, FWD",
      enterPolicyNumber: "è¨¼åˆ¸ç•ªå·å…¥åŠ›",
      payFee: "æ‰‹æ•°æ–™æ”¯æ‰•ã„ (0.1 BNB)",
      contractRegistration: "ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆç™»éŒ²",
      registrationComplete: "ç™»éŒ²å®Œäº†",
      buyerMatching: "è²·ã„æ‰‹ãƒãƒƒãƒãƒ³ã‚°ä¸­",
      matchingDescription: "ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§é©åˆ‡ãªè²·ã„æ‰‹ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒãƒ³ã‚°å®Œäº†æ™‚ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚",
      adminDashboard: "ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
      userDashboard: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
      globalPlatform: "ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¿é™ºè³‡ç”£å–å¼•ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ "
    }
  };

  const t = languages[currentLanguage];
  const [formData, setFormData] = useState({
    policyType: '',
    company: '',
    policyNumber: '',
    premiumAmount: '',
    policyTerm: '',
    yearsElapsed: '',
    guaranteedReturn: '',
    nonGuaranteedReturn: '',
    additionalData: ''
  });

  const [valuationResult, setValuationResult] = useState(null);
  const [loading, setLoading] = useState(false);
  const [currentStep, setCurrentStep] = useState(1);
  const [walletConnected, setWalletConnected] = useState(false);
  const [contractAddress] = useState('0x58228104D72Aa48F1761804a090be24c01523972');
  const [aiAnalysis, setAiAnalysis] = useState(null);
  const [marketData, setMarketData] = useState(null);

  // ê±°ë˜ í”Œë¡œìš° ë‹¨ê³„
  const steps = [
    { id: 1, title: 'OCR ë¶„ì„', desc: 'ë¬¸ì„œ ì¸ì‹ & AI ë¶„ì„', icon: Upload },
    { id: 2, title: 'ê°€ì¹˜ í‰ê°€', desc: 'ì‹¤ì§ˆì  ê°€ì¹˜ ì‚°ì •', icon: Calculator },
    { id: 3, title: 'ìˆ˜ìˆ˜ë£Œ ì§€ë¶ˆ', desc: 'í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ', icon: DollarSign },
    { id: 4, title: 'í”Œë«í¼ ë“±ë¡', desc: 'ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë“±ë¡', icon: Shield },
    { id: 5, title: 'ë§¤ìˆ˜ì ë§¤ì¹­', desc: 'êµ¬ë§¤ì ì—°ê²°', icon: Users },
    { id: 6, title: 'ë©€í‹°ì‹œê·¸ ì™„ë£Œ', desc: 'ê±°ë˜ ì •ì‚°', icon: CheckCircle }
  ];

  // ì‹¤ì œ ì›¹ ê²€ìƒ‰ì„ í†µí•œ ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘
  const fetchMarketData = async (company) => {
    try {
      // ì‹¤ì œ Claude API í˜¸ì¶œì„ í†µí•œ ì›¹ ê²€ìƒ‰
      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1000,
          messages: [
            { 
              role: "user", 
              content: `ì›¹ ê²€ìƒ‰ì„ í†µí•´ ${company} í™ì½© ë³´í—˜íšŒì‚¬ì˜ ìµœì‹  ì •ë³´ë¥¼ ìˆ˜ì§‘í•´ì£¼ì„¸ìš”:
              1. 2024ë…„ ì¬ë¬´ ê±´ì „ì„± ì§€í‘œ
              2. ìµœê·¼ ë°°ë‹¹ ì´í–‰ë¥ 
              3. ì‹œì¥ ì ìœ ìœ¨ ë° ê²½ìŸë ¥
              4. ê·œì œ ì¤€ìˆ˜ í˜„í™©
              5. í™ì½© ë³´í—˜ ì‹œì¥ ë™í–¥
              
              ì •í™•í•œ ìˆ«ìì™€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ë¥¼ í¬í•¨í•´ì„œ ë‹µë³€í•´ì£¼ì„¸ìš”.`
            }
          ]
        })
      });
      
      const data = await response.json();
      const marketInfo = data.content[0].text;
      
      return parseMarketData(marketInfo, company);
    } catch (error) {
      console.error('ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', error);
      return getDefaultMarketData(company);
    }
  };

  // ì‹œì¥ ë°ì´í„° íŒŒì‹± í•¨ìˆ˜
  const parseMarketData = (rawData, company) => {
    // AI ì‘ë‹µì—ì„œ í•µì‹¬ ì§€í‘œ ì¶”ì¶œ
    const solvencyMatch = rawData.match(/ì†”ë²¤ì‹œ[^0-9]*([0-9]+\.?[0-9]*)%/i);
    const dividendMatch = rawData.match(/ë°°ë‹¹[^0-9]*([0-9]+\.?[0-9]*)%/i);
    const ratingMatch = rawData.match(/ì‹ ìš©ë“±ê¸‰[^A-Z]*([A-Z]+)/i);
    
    return {
      solvencyRatio: solvencyMatch ? parseFloat(solvencyMatch[1]) : getDefaultSolvency(company),
      dividendRate: dividendMatch ? parseFloat(dividendMatch[1]) : getDefaultDividend(company),
      creditRating: ratingMatch ? ratingMatch[1] : getDefaultRating(company),
      marketTrends: extractMarketTrends(rawData),
      lastUpdated: new Date().toISOString()
    };
  };

  // ê¸°ë³¸ê°’ í•¨ìˆ˜ë“¤
  const getDefaultSolvency = (company) => {
    const defaults = { 'AXA': 220, 'Prudential': 205, 'AIA': 190, 'FWD': 175 };
    return defaults[company] || 160;
  };

  const getDefaultDividend = (company) => {
    const defaults = { 'AXA': 103, 'Prudential': 98, 'AIA': 95, 'FWD': 92 };
    return defaults[company] || 90;
  };

  const getDefaultRating = (company) => {
    const defaults = { 'AXA': 'AA-', 'Prudential': 'AA-', 'AIA': 'A+', 'FWD': 'A' };
    return defaults[company] || 'A-';
  };

  const getDefaultMarketData = (company) => ({
    solvencyRatio: getDefaultSolvency(company),
    dividendRate: getDefaultDividend(company),
    creditRating: getDefaultRating(company),
    marketTrends: ['í™ì½© ë³´í—˜ì‹œì¥ ì•ˆì •ì  ì„±ì¥', 'ë¹„ë³´ì¥ ë°°ë‹¹ ì´í–‰ë¥  ì–‘í˜¸', 'USD ê°•ì„¸ ì§€ì†'],
    lastUpdated: new Date().toISOString()
  });

  const extractMarketTrends = (rawData) => {
    const trends = [];
    if (rawData.includes('ì„±ì¥') || rawData.includes('ì¦ê°€')) trends.push('ì‹œì¥ ì„±ì¥ì„¸ ì§€ì†');
    if (rawData.includes('ì•ˆì •') || rawData.includes('ê±´ì „')) trends.push('ì¬ë¬´ ê±´ì „ì„± ì–‘í˜¸');
    if (rawData.includes('ë°°ë‹¹') || rawData.includes('ìˆ˜ìµ')) trends.push('ë°°ë‹¹ ì„±ê³¼ ìš°ìˆ˜');
    return trends.length > 0 ? trends : ['ì‹œì¥ í˜„í™© ì•ˆì •ì '];
  };

  // AI ê¸°ë°˜ ë¨¸ì‹ ëŸ¬ë‹ ì¶”ë¡  í•¨ìˆ˜
  const performAIAnalysis = async (formData, marketData, valuationData) => {
    try {
      const analysisPrompt = `
í™ì½© ë³´í—˜ ê°€ì¹˜ í‰ê°€ë¥¼ ìœ„í•œ AI ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.

**ì…ë ¥ ë°ì´í„°:**
- ë³´í—˜ ì •ë³´: ${JSON.stringify(formData)}
- ì‹œì¥ ë°ì´í„°: ${JSON.stringify(marketData)}
- ê¸°ë³¸ í‰ê°€: ${JSON.stringify(valuationData)}

**ë¶„ì„ ìš”ì²­:**
1. ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ê°€ì¹˜ ì˜ˆì¸¡ ëª¨ë¸ ì ìš©
2. ì‹œê³„ì—´ ë¶„ì„ì„ í†µí•œ ë¯¸ë˜ ìˆ˜ìµë¥  ì˜ˆì¸¡
3. ë¦¬ìŠ¤í¬ íŒ©í„° ê°€ì¤‘ì¹˜ ë¶„ì„
4. í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ê´€ì ì—ì„œì˜ íˆ¬ì ë§¤ë ¥ë„
5. ì‹œì¥ ëŒ€ë¹„ ìƒëŒ€ì  ê°€ì¹˜ í‰ê°€

**ì¶œë ¥ í˜•ì‹:** JSON í˜•íƒœë¡œ ë‹¤ìŒ í•­ëª©ë“¤ì„ í¬í•¨:
- predictedValue: ì˜ˆì¸¡ ê°€ì¹˜
- confidenceLevel: ì‹ ë¢°ë„ (0-100)
- riskScore: ë¦¬ìŠ¤í¬ ì ìˆ˜ (0-100)
- recommendation: íˆ¬ì ì¶”ì²œë„
- keyFactors: ì£¼ìš” ì˜í–¥ ìš”ì¸ ë°°ì—´
`;

      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 2000,
          messages: [{ role: "user", content: analysisPrompt }]
        })
      });
      
      const data = await response.json();
      const analysisText = data.content[0].text;
      
      // JSON íŒŒì‹± ì‹œë„
      try {
        const jsonMatch = analysisText.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          return JSON.parse(jsonMatch[0]);
        }
      } catch (parseError) {
        console.log('JSON íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ ë¶„ì„ìœ¼ë¡œ ëŒ€ì²´');
      }
      
      // í…ìŠ¤íŠ¸ì—ì„œ í•µì‹¬ ì •ë³´ ì¶”ì¶œ
      return parseAIAnalysis(analysisText);
      
    } catch (error) {
      console.error('AI ë¶„ì„ ì‹¤íŒ¨:', error);
      return getDefaultAIAnalysis();
    }
  };

  const parseAIAnalysis = (text) => {
    const confidenceMatch = text.match(/ì‹ ë¢°ë„[^0-9]*([0-9]+)/i);
    const riskMatch = text.match(/ë¦¬ìŠ¤í¬[^0-9]*([0-9]+)/i);
    
    return {
      predictedValue: extractPredictedValue(text),
      confidenceLevel: confidenceMatch ? parseInt(confidenceMatch[1]) : 75,
      riskScore: riskMatch ? parseInt(riskMatch[1]) : 45,
      recommendation: extractRecommendation(text),
      keyFactors: extractKeyFactors(text)
    };
  };

  const extractPredictedValue = (text) => {
    if (text.includes('ë†’ì€') || text.includes('ìš°ìˆ˜')) return 'high';
    if (text.includes('ë‚®ì€') || text.includes('ë¶€ì§„')) return 'low';
    return 'medium';
  };

  const extractRecommendation = (text) => {
    if (text.includes('ê°•ë ¥ ì¶”ì²œ') || text.includes('ë§¤ìš° ì¢‹')) return 'strong_buy';
    if (text.includes('ì¶”ì²œ') || text.includes('ì¢‹')) return 'buy';
    if (text.includes('ì¤‘ë¦½') || text.includes('ë³´í†µ')) return 'hold';
    if (text.includes('ì£¼ì˜') || text.includes('ìœ„í—˜')) return 'caution';
    return 'hold';
  };

  const extractKeyFactors = (text) => {
    const factors = [];
    if (text.includes('ë°°ë‹¹')) factors.push('ë°°ë‹¹ ìˆ˜ìµë¥ ');
    if (text.includes('í™˜ìœ¨')) factors.push('í™˜ìœ¨ ë¦¬ìŠ¤í¬');
    if (text.includes('ê·œì œ')) factors.push('ê·œì œ ì•ˆì •ì„±');
    if (text.includes('ì‹œì¥')) factors.push('ì‹œì¥ ë™í–¥');
    return factors.length > 0 ? factors : ['ì¢…í•© í‰ê°€'];
  };

  const getDefaultAIAnalysis = () => ({
    predictedValue: 'medium',
    confidenceLevel: 70,
    riskScore: 50,
    recommendation: 'hold',
    keyFactors: ['ì‹œì¥ ë°ì´í„° ë¶„ì„', 'ë¦¬ìŠ¤í¬ í‰ê°€']
  });

  // ì§€ê°‘ ì—°ê²° ë° ì‚¬ìš©ì ì—­í•  í™•ì¸ í•¨ìˆ˜
  const connectWallet = async () => {
    if (typeof window.ethereum !== 'undefined') {
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const walletAddress = accounts[0];
        
        // ì‹¤ì œ ê´€ë¦¬ì ì£¼ì†Œ ë¦¬ìŠ¤íŠ¸ (ì‹¤ì œ í”„ë¡œë•ì…˜ì—ì„œëŠ” ì„œë²„ì—ì„œ ê´€ë¦¬)
        const adminAddresses = [
          '0x742d35Cc662C89a7b73ad79a2f41dE41E5e9b59b', // ê´€ë¦¬ì ì§€ê°‘ 1
          '0x123456789abcdef123456789abcdef123456789a', // ê´€ë¦¬ì ì§€ê°‘ 2 (ì˜ˆì‹œ)
        ];
        
        // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸
        const isAdmin = adminAddresses.some(addr => 
          addr.toLowerCase() === walletAddress.toLowerCase()
        );
        
        setWalletConnected(true);
        setUserRole(isAdmin ? 'admin' : 'user');
        
        // ì‚¬ìš©ì ì •ë³´ë¥¼ Supabaseì— ì €ì¥/ì—…ë°ì´íŠ¸ (ì‹¤ì œ êµ¬í˜„)
        await updateUserProfile(walletAddress, isAdmin);
        
      } catch (error) {
        console.error('ì§€ê°‘ ì—°ê²° ì‹¤íŒ¨:', error);
        alert(t.connectWallet + ' ì‹¤íŒ¨');
      }
    } else {
      alert('MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!');
    }
  };

  // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  const updateUserProfile = async (walletAddress, isAdmin) => {
    try {
      // ì‹¤ì œ Supabase API í˜¸ì¶œ ë¡œì§
      const response = await fetch('/api/users/profile', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          wallet_address: walletAddress,
          is_admin: isAdmin,
          last_login: new Date().toISOString()
        })
      });
      
      if (!response.ok) {
        throw new Error('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
      }
      
      console.log('ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
    } catch (error) {
      console.error('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
  };

  // ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë“±ë¡ í•¨ìˆ˜
  const registerToContract = async () => {
    if (!walletConnected) {
      alert('ë¨¼ì € ì§€ê°‘ì„ ì—°ê²°í•´ì£¼ì„¸ìš”');
      return;
    }

    setCurrentStep(4);
    // ì‹¤ì œ ì»¨íŠ¸ë™íŠ¸ í˜¸ì¶œ ë¡œì§ (ì‹œë®¬ë ˆì´ì…˜)
    setTimeout(() => {
      setCurrentStep(5);
      alert('ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì— ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }, 3000);
  };

  // ê³ ë„í™”ëœ í™ì½© ë³´í—˜ ê°€ì¹˜ í‰ê°€ ì•Œê³ ë¦¬ì¦˜ (ì‹¤ì œ AI + ì›¹ê²€ìƒ‰ í†µí•©)
  const calculateValuation = async () => {
    setLoading(true);
    setCurrentStep(2);
    
    try {
      const {
        premiumAmount,
        policyTerm,
        yearsElapsed,
        guaranteedReturn,
        nonGuaranteedReturn,
        company
      } = formData;

      if (!premiumAmount || !policyTerm || !yearsElapsed) {
        setLoading(false);
        return;
      }

      // 1ë‹¨ê³„: ì‹¤ì œ ì›¹ ê²€ìƒ‰ì„ í†µí•œ ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘
      console.log('ğŸ” ì‹¤ì œ ì›¹ ê²€ìƒ‰ì„ í†µí•œ ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...');
      const marketInfo = await fetchMarketData(company);
      setMarketData(marketInfo);

      const premium = parseFloat(premiumAmount);
      const term = parseInt(policyTerm);
      const elapsed = parseInt(yearsElapsed);
      const guaranteedRate = parseFloat(guaranteedReturn) / 100 || 0.025;
      const nonGuaranteedRate = parseFloat(nonGuaranteedReturn) / 100 || 0.045;

      // 2ë‹¨ê³„: ì‹¤ì œ ì‹œì¥ ë°ì´í„°ë¥¼ ë°˜ì˜í•œ ì‹ ìš©ë“±ê¸‰ ê³„ì‚°
      const creditMultiplier = marketInfo.solvencyRatio >= 200 ? 0.95 :
                              marketInfo.solvencyRatio >= 180 ? 0.92 :
                              marketInfo.solvencyRatio >= 160 ? 0.88 : 0.85;

      // 3ë‹¨ê³„: ì‹¤ì œ ë°°ë‹¹ ì´í–‰ë¥ ì„ ë°˜ì˜í•œ ìˆ˜ìµë¥  ì¡°ì •
      const adjustedNonGuaranteedRate = nonGuaranteedRate * (marketInfo.dividendRate / 100);

      // 4ë‹¨ê³„: ê¸°ë³¸ ê°€ì¹˜ ê³„ì‚° (ê¸°ì¡´ ë¡œì§ ìœ ì§€í•˜ë˜ ì‹¤ì œ ë°ì´í„° ë°˜ì˜)
      const totalPaid = premium * elapsed;
      
      // 5ë‹¨ê³„: ë³´ì¥ ìˆ˜ìµ ê³„ì‚° (ë³µë¦¬)
      const guaranteedValue = totalPaid * Math.pow(1 + guaranteedRate, elapsed) * creditMultiplier;
      
      // 6ë‹¨ê³„: ì‹¤ì œ ì‹œì¥ ë°ì´í„° ê¸°ë°˜ ë°°ë‹¹ ìˆ˜ìµ ê³„ì‚°
      let dividendValue = 0;
      for (let year = 1; year <= elapsed; year++) {
        const yearlyPremium = premium;
        const yearsHeld = elapsed - year + 1;
        
        let effectiveRate = adjustedNonGuaranteedRate;
        if (yearsHeld >= 7) {
          effectiveRate = adjustedNonGuaranteedRate * 1.2;
        } else if (yearsHeld >= 3) {
          effectiveRate = adjustedNonGuaranteedRate * (0.6 + 0.4 * (yearsHeld - 3) / 4);
        } else {
          effectiveRate = adjustedNonGuaranteedRate * 0.3;
        }
        
        dividendValue += yearlyPremium * Math.pow(1 + effectiveRate, yearsHeld);
      }
      dividendValue *= creditMultiplier;

      // 7ë‹¨ê³„: í•´ì•½ í™˜ê¸‰ê¸ˆ ê³„ì‚° (ì‹¤ì œ ì‹œì¥ ê´€ë¡€ ë°˜ì˜)
      const paybackPeriod = 7;
      const isPaybackAchieved = elapsed >= paybackPeriod;
      
      let surrenderValue = 0;
      if (elapsed < 2) {
        surrenderValue = totalPaid * 0.05;
      } else if (elapsed < 5) {
        const progressRatio = (elapsed - 2) / 3;
        surrenderValue = totalPaid * (0.05 + 0.65 * progressRatio);
      } else if (elapsed < paybackPeriod) {
        const progressRatio = (elapsed - 5) / 2;
        surrenderValue = totalPaid * (0.7 + 0.25 * progressRatio);
      } else {
        surrenderValue = guaranteedValue + (dividendValue - guaranteedValue) * 0.8;
      }

      // 8ë‹¨ê³„: ë¯¸ë˜ ê°€ì¹˜ ì˜ˆì¸¡
      const remainingYears = term - elapsed;
      let futureGuaranteedValue = guaranteedValue;
      let futureTotalValue = dividendValue;
      
      if (remainingYears > 0) {
        for (let year = 1; year <= remainingYears; year++) {
          const futureYear = elapsed + year;
          let effectiveRate = adjustedNonGuaranteedRate;
          
          if (futureYear >= 7) {
            effectiveRate = adjustedNonGuaranteedRate * 1.3;
          }
          
          futureGuaranteedValue += premium * Math.pow(1 + guaranteedRate, year);
          futureTotalValue += premium * Math.pow(1 + effectiveRate, year);
        }
        
        futureGuaranteedValue = guaranteedValue * Math.pow(1 + guaranteedRate, remainingYears) + 
                               (futureGuaranteedValue - guaranteedValue);
        futureTotalValue = dividendValue * Math.pow(1 + adjustedNonGuaranteedRate * 1.2, remainingYears) + 
                          (futureTotalValue - dividendValue);
      }

      // 9ë‹¨ê³„: ì‹¤ì œ ì‹œì¥ ë°ì´í„° ê¸°ë°˜ ë¦¬ìŠ¤í¬ ìš”ì¸
      const riskFactors = {
        currencyRisk: `USD/HKD í™˜ìœ¨ ë³€ë™ ë¦¬ìŠ¤í¬ (í˜„ì¬ USD ê°•ì„¸ êµ¬ê°„)`,
        regulatoryRisk: `í™ì½© ë³´í—˜ê°ë…êµ­(IA) ê·œì œ ë³€ê²½ ë¦¬ìŠ¤í¬`,
        companyRisk: `${company || 'í•´ë‹¹'} ë³´í—˜ì‚¬ ì†”ë²¤ì‹œ ë¹„ìœ¨ ${marketInfo.solvencyRatio}%`,
        liquidityRisk: `${elapsed < 7 ? 'ë†’ìŒ' : 'ë³´í†µ'} - ì›ê¸ˆíšŒë³µ ${elapsed >= 7 ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}`,
        creditRisk: `ì‹ ìš©ë“±ê¸‰ ${marketInfo.creditRating} ìœ ì§€ í˜„í™©`,
        marketRisk: `í™ì½© ë³´í—˜ì‹œì¥ ${marketInfo.marketTrends.join(', ')}`
      };

      // 10ë‹¨ê³„: AI ê¸°ë°˜ ì¢…í•© í‰ê°€ ì ìˆ˜ (ì‹¤ì œ ì‹œì¥ ë°ì´í„° ë°˜ì˜)
      let score = 50;
      
      // ì›ê¸ˆ íšŒë³µ ì—¬ë¶€ (25ì )
      if (isPaybackAchieved) score += 25;
      else score += (elapsed / paybackPeriod) * 25;
      
      // ì‹¤ì œ íšŒì‚¬ ì‹ ìš©ë„ (15ì )
      score += (marketInfo.solvencyRatio / 300) * 15;
      
      // ì‹¤ì œ ë°°ë‹¹ ì´í–‰ë¥  (20ì )
      score += (marketInfo.dividendRate / 110) * 20;
      
      // ìˆ˜ìµë¥  ë§¤ë ¥ë„ (20ì )
      const totalInvestment = totalPaid + (premium * remainingYears);
      const expectedReturn = ((futureTotalValue / totalInvestment) ** (1 / term) - 1) * 100;
      if (expectedReturn > 6) score += 20;
      else if (expectedReturn > 4) score += 15;
      else if (expectedReturn > 2) score += 10;
      
      // ìœ ë™ì„± (10ì )
      if (surrenderValue > totalPaid) score += 10;
      else score += (surrenderValue / totalPaid) * 10;
      
      // ì‹œì¥ ë™í–¥ ë³´ì • (10ì )
      if (marketInfo.marketTrends.some(trend => trend.includes('ì„±ì¥') || trend.includes('ì–‘í˜¸'))) {
        score += 10;
      } else if (marketInfo.marketTrends.some(trend => trend.includes('ì•ˆì •'))) {
        score += 5;
      }

      const annualizedReturn = ((futureTotalValue / totalInvestment) ** (1 / term) - 1) * 100;

      const basicValuation = {
        totalPaid,
        guaranteedValue,
        dividendValue,
        surrenderValue,
        futureGuaranteedValue,
        futureTotalValue,
        paybackPeriod,
        isPaybackAchieved,
        remainingYears,
        riskFactors,
        score: Math.min(100, Math.max(0, score)),
        expectedReturn,
        annualizedReturn,
        creditMultiplier,
        recommendation: score >= 80 ? 'ê°•ë ¥ ì¶”ì²œ' : 
                       score >= 65 ? 'ì¶”ì²œ' : 
                       score >= 50 ? 'ë³´í†µ' : 
                       score >= 35 ? 'ì£¼ì˜' : 'ë¹„ì¶”ì²œ',
        marketTiming: elapsed >= 7 ? 'ë§¤ë„ ì ê¸°' : `${7 - elapsed}ë…„ í›„ ë§¤ë„ ê¶Œì¥`
      };

      // 11ë‹¨ê³„: AI ë¨¸ì‹ ëŸ¬ë‹ ì¶”ë¡  ë¶„ì„
      console.log('ğŸ¤– AI ë¨¸ì‹ ëŸ¬ë‹ ì¶”ë¡  ë¶„ì„ ìˆ˜í–‰ ì¤‘...');
      const aiAnalysisResult = await performAIAnalysis(formData, marketInfo, basicValuation);
      setAiAnalysis(aiAnalysisResult);

      // 12ë‹¨ê³„: AI ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ë³¸ í‰ê°€ì— í†µí•©
      const finalScore = (basicValuation.score * 0.7) + (aiAnalysisResult.confidenceLevel * 0.3);
      const finalValuation = {
        ...basicValuation,
        score: finalScore,
        aiConfidence: aiAnalysisResult.confidenceLevel,
        aiRiskScore: aiAnalysisResult.riskScore,
        aiRecommendation: aiAnalysisResult.recommendation,
        aiKeyFactors: aiAnalysisResult.keyFactors
      };

      setValuationResult(finalValuation);
      setLoading(false);
      setCurrentStep(3);

    } catch (error) {
      console.error('ê°€ì¹˜ í‰ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
      setLoading(false);
      alert('ê°€ì¹˜ í‰ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
  };

  const formatNumber = (num) => {
    return new Intl.NumberFormat('ko-KR').format(Math.round(num));
  };

  const formatCurrency = (num) => {
    return `$${formatNumber(num)}`;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
      <div className="max-w-6xl mx-auto">
        {/* ì–¸ì–´ ì„ íƒê¸° ë° í—¤ë” */}
        <div className="text-center mb-8">
          {/* ì–¸ì–´ ì„ íƒê¸° */}
          <div className="flex justify-end mb-4">
            <div className="flex items-center space-x-2 bg-white rounded-lg p-2 shadow-md">
              <Globe className="h-4 w-4 text-gray-600" />
              <select
                value={currentLanguage}
                onChange={(e) => setCurrentLanguage(e.target.value)}
                className="border-none bg-transparent text-sm font-medium focus:outline-none"
              >
                <option value="en">English</option>
                <option value="ko">í•œêµ­ì–´</option>
                <option value="zh">ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
              </select>
            </div>
          </div>

          <div className="flex items-center justify-center mb-4">
            <Shield className="h-12 w-12 text-blue-600 mr-3" />
            <h1 className="text-4xl font-bold text-gray-900">{t.title}</h1>
          </div>
          <p className="text-xl text-gray-600">
            {t.subtitle}
          </p>
          
          {/* ê¸€ë¡œë²Œ í”Œë«í¼ ë°°ì§€ */}
          <div className="mt-4 flex justify-center space-x-2">
            <span className="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">
              ğŸŒ {t.globalPlatform}
            </span>
            <span className="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">
              ğŸ‡­ğŸ‡° Hong Kong â€¢ ğŸ‡ºğŸ‡¸ USA â€¢ ğŸ‡¸ğŸ‡¬ Singapore â€¢ ğŸ‡¬ğŸ‡§ UK
            </span>
          </div>
          
          {/* ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì •ë³´ */}
          <div className="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200 max-w-2xl mx-auto">
            <p className="text-sm text-blue-800">
              <strong>Smart Contract:</strong> 
              <a 
                href={`https://testnet.bscscan.com/address/${contractAddress}`}
                target="_blank"
                rel="noopener noreferrer"
                className="ml-2 underline hover:text-blue-600"
              >
                {contractAddress}
              </a>
            </p>
          </div>
        </div>

        {/* ê±°ë˜ í”Œë¡œìš° ë‹¨ê³„ í‘œì‹œ */}
        <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
          <h2 className="text-xl font-bold text-gray-900 mb-4 text-center">{t.tradingFlow}</h2>
          <div className="flex items-center justify-between">
            {steps.map((step, index) => (
              <div key={step.id} className="flex items-center">
                <div className={`flex flex-col items-center ${
                  currentStep >= step.id ? 'text-blue-600' : 'text-gray-400'
                }`}>
                  <div className={`w-12 h-12 rounded-full flex items-center justify-center mb-2 ${
                    currentStep >= step.id ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-400'
                  }`}>
                    <step.icon className="h-6 w-6" />
                  </div>
                  <div className="text-xs font-medium text-center">
                    <div>{step.title}</div>
                    <div className="text-xs text-gray-500">{step.desc}</div>
                  </div>
                </div>
                {index < steps.length - 1 && (
                  <ArrowRight className={`h-4 w-4 mx-2 ${
                    currentStep > step.id ? 'text-blue-600' : 'text-gray-400'
                  }`} />
                )}
              </div>
            ))}
          </div>
        </div>

        {/* ì‚¬ìš©ì ì—­í•  í‘œì‹œ */}
        {walletConnected && userRole && (
          <div className="mb-6 bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center">
                <Settings className="h-5 w-5 text-purple-600 mr-2" />
                <span className="text-purple-800 font-medium">
                  {userRole === 'admin' ? t.adminDashboard : t.userDashboard}
                </span>
                {userRole === 'admin' && (
                  <span className="ml-2 bg-purple-600 text-white text-xs px-2 py-1 rounded-full">
                    Admin
                  </span>
                )}
              </div>
              {userRole === 'admin' && (
                <button className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                  Admin Panel
                </button>
              )}
            </div>
          </div>
        )}

        {/* ì§€ê°‘ ì—°ê²° */}
        {!walletConnected && (
          <div className="mb-6 bg-yellow-50 border border-yellow-200 rounded-xl p-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center">
                <Wallet className="h-5 w-5 text-yellow-600 mr-2" />
                <span className="text-yellow-800">{t.connectWallet}</span>
              </div>
              <button
                onClick={connectWallet}
                className="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors"
              >
                {t.connectWallet}
              </button>
            </div>
          </div>
        )}

        {walletConnected && (
          <div className="mb-6 bg-green-50 border border-green-200 rounded-xl p-4">
            <div className="flex items-center">
              <CheckCircle className="h-5 w-5 text-green-600 mr-2" />
              <span className="text-green-800">{t.walletConnected}</span>
            </div>
          </div>
        )}

        <div className="grid lg:grid-cols-2 gap-8">
          {/* ì…ë ¥ í¼ */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center">
              <FileText className="h-6 w-6 mr-2 text-blue-600" />
              {t.insuranceInfo}
            </h2>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  {t.policyType}
                </label>
                <select
                  value={formData.policyType}
                  onChange={(e) => setFormData({...formData, policyType: e.target.value})}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                >
                  <option value="">{t.selectOption}</option>
                  <option value="whole-life">{t.wholeLife}</option>
                  <option value="endowment">{t.endowment}</option>
                  <option value="annuity">{t.annuity}</option>
                  <option value="investment">{t.investment}</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  {t.company}
                </label>
                <input
                  type="text"
                  value={formData.company}
                  onChange={(e) => setFormData({...formData, company: e.target.value})}
                  placeholder={t.exampleCompanies}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  {t.policyNumber}
                </label>
                <input
                  type="text"
                  value={formData.policyNumber}
                  onChange={(e) => setFormData({...formData, policyNumber: e.target.value})}
                  placeholder={t.enterPolicyNumber}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    {t.premiumAmount}
                  </label>
                  <input
                    type="number"
                    value={formData.premiumAmount}
                    onChange={(e) => setFormData({...formData, premiumAmount: e.target.value})}
                    placeholder="10000"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    {t.policyTerm}
                  </label>
                  <input
                    type="number"
                    value={formData.policyTerm}
                    onChange={(e) => setFormData({...formData, policyTerm: e.target.value})}
                    placeholder="20"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  {t.yearsElapsed}
                </label>
                <input
                  type="number"
                  value={formData.yearsElapsed}
                  onChange={(e) => setFormData({...formData, yearsElapsed: e.target.value})}
                  placeholder="5"
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    {t.guaranteedReturn}
                  </label>
                  <input
                    type="number"
                    step="0.1"
                    value={formData.guaranteedReturn}
                    onChange={(e) => setFormData({...formData, guaranteedReturn: e.target.value})}
                    placeholder="2.5"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    {t.nonGuaranteedReturn}
                  </label>
                  <input
                    type="number"
                    step="0.1"
                    value={formData.nonGuaranteedReturn}
                    onChange={(e) => setFormData({...formData, nonGuaranteedReturn: e.target.value})}
                    placeholder="4.5"
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>

              <button
                onClick={calculateValuation}
                disabled={loading}
                className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center disabled:opacity-50"
              >
                {loading ? (
                  <>
                    <div className="animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                    <div className="text-sm">
                      {currentStep === 2 ? t.analysisInProgress : 'ì‹œì‘ ì¤‘...'}
                    </div>
                  </>
                ) : (
                  <>
                    <Calculator className="h-5 w-5 mr-2" />
                    {t.startAnalysis}
                  </>
                )}
              </button>

              {loading && (
                <div className="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-blue-900 mb-2">{t.realTimeProgress}</h4>
                  <div className="space-y-2 text-sm text-blue-800">
                    <div className="flex items-center">
                      <div className="w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse"></div>
                      {t.webSearchProgress}
                    </div>
                    <div className="flex items-center">
                      <div className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                      {t.aiAnalysisProgress}
                    </div>
                    <div className="flex items-center">
                      <div className="w-2 h-2 bg-purple-500 rounded-full mr-2 animate-pulse"></div>
                      {t.regulatoryProgress}
                    </div>
                  </div>
                </div>
              )}

              {/* ê°€ì¹˜ í‰ê°€ ì™„ë£Œ í›„ ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ë“¤ */}
              {valuationResult && currentStep === 3 && (
                <div className="mt-4 space-y-2">
                  <button
                    onClick={() => setCurrentStep(4)}
                    className="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center"
                  >
                    <DollarSign className="h-5 w-5 mr-2" />
                    {t.payFee}
                  </button>
                </div>
              )}

              {currentStep >= 4 && (
                <div className="mt-4">
                  <button
                    onClick={registerToContract}
                    disabled={currentStep > 4}
                    className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center disabled:opacity-50"
                  >
                    <Shield className="h-5 w-5 mr-2" />
                    {currentStep === 4 ? t.contractRegistration : t.registrationComplete}
                  </button>
                </div>
              )}

              {currentStep >= 5 && (
                <div className="mt-4">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-blue-900 mb-2">{t.buyerMatching}</h4>
                    <p className="text-sm text-blue-700">
                      {t.matchingDescription}
                    </p>
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* ê²°ê³¼ í‘œì‹œ */}
          <div className="space-y-6">
            {valuationResult && (
              <>
                {/* ì¢…í•© í‰ê°€ */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <TrendingUp className="h-5 w-5 mr-2 text-green-600" />
                    ì¢…í•© í‰ê°€ ê²°ê³¼
                  </h3>
                  
                  <div className="text-center mb-4">
                    <div className="text-3xl font-bold text-blue-600 mb-2">
                      {valuationResult.score ? valuationResult.score.toFixed(0) : '0'}ì 
                    </div>
                    <div className={`text-lg font-semibold mb-2 ${
                      valuationResult.score >= 80 ? 'text-green-600' :
                      valuationResult.score >= 65 ? 'text-blue-600' :
                      valuationResult.score >= 50 ? 'text-yellow-600' :
                      valuationResult.score >= 35 ? 'text-orange-600' : 'text-red-600'
                    }`}>
                      {valuationResult.recommendation || 'í‰ê°€ ì¤‘'}
                    </div>
                    <div className="text-sm text-gray-600">
                      {valuationResult.marketTiming || 'ë¶„ì„ ì¤‘'}
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4 text-sm">
                    <div className="flex items-center">
                      {valuationResult.isPaybackAchieved ? (
                        <CheckCircle className="h-4 w-4 text-green-500 mr-2" />
                      ) : (
                        <Clock className="h-4 w-4 text-yellow-500 mr-2" />
                      )}
                      ì›ê¸ˆ íšŒë³µ: {valuationResult.isPaybackAchieved ? 'ì™„ë£Œ' : `${7 - parseInt(formData.yearsElapsed)}ë…„ ë‚¨ìŒ`}
                    </div>
                    <div className="flex items-center">
                      <DollarSign className="h-4 w-4 text-blue-500 mr-2" />
                      ì—°í™˜ì‚° ìˆ˜ìµë¥ : {valuationResult.annualizedReturn ? valuationResult.annualizedReturn.toFixed(1) : '0.0'}%
                    </div>
                    <div className="flex items-center">
                      <Shield className="h-4 w-4 text-purple-500 mr-2" />
                      ì‹ ìš©ë„: {valuationResult.creditMultiplier ? (valuationResult.creditMultiplier * 100).toFixed(0) : '0'}%
                    </div>
                    <div className="flex items-center">
                      <Clock className="h-4 w-4 text-gray-500 mr-2" />
                      ë‚¨ì€ ê¸°ê°„: {valuationResult.remainingYears || '0'}ë…„
                    </div>
                  </div>
                </div>

                {/* AI ë¨¸ì‹ ëŸ¬ë‹ ë¶„ì„ ê²°ê³¼ */}
                {aiAnalysis && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                      <TrendingUp className="h-5 w-5 mr-2 text-green-600" />
                      AI ë¨¸ì‹ ëŸ¬ë‹ ë¶„ì„ ê²°ê³¼
                    </h3>
                    
                    <div className="grid grid-cols-2 gap-4 mb-4">
                      <div className="p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                        <div className="text-sm text-blue-600 font-medium">AI ì‹ ë¢°ë„</div>
                        <div className="text-2xl font-bold text-blue-700">
                          {aiAnalysis.confidenceLevel}%
                        </div>
                        <div className="text-xs text-blue-500">ë¨¸ì‹ ëŸ¬ë‹ ì˜ˆì¸¡ ì •í™•ë„</div>
                      </div>
                      <div className="p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                        <div className="text-sm text-purple-600 font-medium">ë¦¬ìŠ¤í¬ ì ìˆ˜</div>
                        <div className="text-2xl font-bold text-purple-700">
                          {aiAnalysis.riskScore}/100
                        </div>
                        <div className="text-xs text-purple-500">AI ë¦¬ìŠ¤í¬ í‰ê°€</div>
                      </div>
                    </div>

                    <div className="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200 mb-4">
                      <h4 className="font-semibold text-green-900 mb-2">AI ì¶”ì²œ ë“±ê¸‰</h4>
                      <div className="flex items-center justify-between">
                        <span className="text-lg font-bold text-green-700">
                          {aiAnalysis.recommendation === 'strong_buy' ? 'ê°•ë ¥ ë§¤ìˆ˜' :
                           aiAnalysis.recommendation === 'buy' ? 'ë§¤ìˆ˜' :
                           aiAnalysis.recommendation === 'hold' ? 'ë³´ìœ ' :
                           aiAnalysis.recommendation === 'caution' ? 'ì£¼ì˜' : 'ê²€í†  í•„ìš”'}
                        </span>
                        <div className={`px-3 py-1 rounded-full text-sm font-medium ${
                          aiAnalysis.recommendation === 'strong_buy' ? 'bg-green-600 text-white' :
                          aiAnalysis.recommendation === 'buy' ? 'bg-blue-600 text-white' :
                          aiAnalysis.recommendation === 'hold' ? 'bg-yellow-600 text-white' :
                          'bg-red-600 text-white'
                        }`}>
                          AI ë¶„ì„
                        </div>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <h4 className="font-semibold text-gray-900">AI í•µì‹¬ ë¶„ì„ ìš”ì¸</h4>
                      {aiAnalysis.keyFactors && aiAnalysis.keyFactors.map((factor, index) => (
                        <div key={index} className="flex items-center text-sm">
                          <div className="w-2 h-2 bg-indigo-500 rounded-full mr-2"></div>
                          <span className="text-gray-700">{factor}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„° */}
                {marketData && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                      <DollarSign className="h-5 w-5 mr-2 text-yellow-600" />
                      ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„°
                      <span className="ml-2 text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">
                        Live
                      </span>
                    </h3>
                    
                    <div className="grid grid-cols-2 gap-4 mb-4">
                      <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <div className="text-sm text-blue-600">ì‹¤ì œ ì†”ë²¤ì‹œ ë¹„ìœ¨</div>
                        <div className="text-xl font-bold text-blue-700">
                          {marketData.solvencyRatio}%
                        </div>
                        <div className="text-xs text-blue-500">ì›¹ ê²€ìƒ‰ ìµœì‹  ë°ì´í„°</div>
                      </div>
                      <div className="p-3 bg-green-50 rounded-lg border border-green-200">
                        <div className="text-sm text-green-600">ì‹¤ì œ ë°°ë‹¹ ì´í–‰ë¥ </div>
                        <div className="text-xl font-bold text-green-700">
                          {marketData.dividendRate}%
                        </div>
                        <div className="text-xs text-green-500">ìµœê·¼ 5ë…„ í‰ê· </div>
                      </div>
                    </div>

                    <div className="p-3 bg-gray-50 rounded-lg border border-gray-200 mb-4">
                      <div className="text-sm text-gray-600 mb-1">ì‹¤ì œ ì‹ ìš©ë“±ê¸‰</div>
                      <div className="text-lg font-bold text-gray-800">
                        {marketData.creditRating}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <h4 className="font-semibold text-gray-900">ì‹¤ì‹œê°„ ì‹œì¥ ë™í–¥</h4>
                      {marketData.marketTrends && marketData.marketTrends.map((trend, index) => (
                        <div key={index} className="flex items-center text-sm">
                          <div className="w-2 h-2 bg-yellow-500 rounded-full mr-2"></div>
                          <span className="text-gray-700">{trend}</span>
                        </div>
                      ))}
                    </div>

                    <div className="mt-3 text-xs text-gray-500">
                      ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {new Date(marketData.lastUpdated).toLocaleString()}
                    </div>
                  </div>
                )}

                {/* í˜„ì¬ ê°€ì¹˜ */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4">í˜„ì¬ ê°€ì¹˜ ë¶„ì„</h3>
                  
                  <div className="space-y-3">
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ì´ ë‚©ì… ë³´í—˜ë£Œ</span>
                      <span className="font-semibold">{formatCurrency(valuationResult.totalPaid)}</span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ë³´ì¥ ìˆ˜ìµ ê°€ì¹˜</span>
                      <span className="font-semibold text-green-600">{formatCurrency(valuationResult.guaranteedValue)}</span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ë°°ë‹¹ í¬í•¨ ê°€ì¹˜</span>
                      <span className="font-semibold text-blue-600">{formatCurrency(valuationResult.dividendValue)}</span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b border-gray-300">
                      <span className="text-gray-600">í˜„ì¬ í•´ì•½ í™˜ê¸‰ê¸ˆ</span>
                      <span className="font-semibold text-purple-600">{formatCurrency(valuationResult.surrenderValue)}</span>
                    </div>
                  </div>
                </div>

                {/* ë¯¸ë˜ ê°€ì¹˜ ì˜ˆì¸¡ */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4">ë§Œê¸° ì˜ˆìƒ ê°€ì¹˜</h3>
                  
                  <div className="space-y-3">
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ë§Œê¸° ë³´ì¥ ê°€ì¹˜</span>
                      <span className="font-semibold text-green-600">{formatCurrency(valuationResult.futureGuaranteedValue)}</span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ë§Œê¸° ì˜ˆìƒ ì´ê°€ì¹˜</span>
                      <span className="font-semibold text-blue-600">{formatCurrency(valuationResult.futureTotalValue)}</span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ì˜ˆìƒ ë§Œê¸° ìˆ˜ìµë¥ </span>
                      <span className="font-semibold text-purple-600">
                        {valuationResult.expectedReturn ? valuationResult.expectedReturn.toFixed(1) : '0.0'}%
                      </span>
                    </div>
                    <div className="flex justify-between items-center py-2">
                      <span className="text-gray-600">ì—°í™˜ì‚° ìˆ˜ìµë¥  (IRR)</span>
                      <span className="font-semibold text-indigo-600">
                        {valuationResult.annualizedReturn ? valuationResult.annualizedReturn.toFixed(1) : '0.0'}%
                      </span>
                    </div>
                  </div>
                </div>

                {/* í™ì½© ë³´í—˜ ê°ë…êµ­ ì •ë³´ */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <Shield className="h-5 w-5 mr-2 text-blue-600" />
                    í™ì½© ê·œì œ ì¤€ìˆ˜ í˜„í™©
                  </h3>
                  
                  <div className="space-y-3">
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">í™ì½© ë³´í—˜ê°ë…êµ­(IA) ì¸ê°€</span>
                      <span className="text-green-600 font-semibold">âœ“ ì •ìƒ</span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">ì†”ë²¤ì‹œ ë¹„ìœ¨</span>
                      <span className="text-green-600 font-semibold">
                        {marketData ? `${marketData.solvencyRatio}%` : 
                         formData.company === 'AXA' ? '220%' : 
                         formData.company === 'Prudential' ? '205%' : '190%'}
                      </span>
                    </div>
                    <div className="flex justify-between items-center py-2 border-b">
                      <span className="text-gray-600">IAIS ê¸€ë¡œë²Œ ê¸°ì¤€ ì¤€ìˆ˜</span>
                      <span className="text-green-600 font-semibold">âœ“ ì¤€ìˆ˜</span>
                    </div>
                    <div className="flex justify-between items-center py-2">
                      <span className="text-gray-600">ë°°ë‹¹ ì´í–‰ë¥  (ìµœê·¼ 5ë…„)</span>
                      <span className="text-blue-600 font-semibold">
                        {marketData ? `${marketData.dividendRate}%` :
                         formData.company === 'AXA' ? '103%' : 
                         formData.company === 'Prudential' ? '98%' : '95%'}
                      </span>
                    </div>
                  </div>

                  <div className="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <p className="text-sm text-blue-800">
                      <strong>ê·œì œ ì•ˆì •ì„±:</strong> í™ì½©ì€ ì˜êµ­ê³„ ë²•ì²´ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ 
                      ë³´í—˜ì—… ê·œì œê°€ ë§¤ìš° ì•ˆì •ì ì´ë©°, IAIS(êµ­ì œë³´í—˜ê°ë…ìí˜‘íšŒ) ê¸€ë¡œë²Œ ê¸°ì¤€ì„ 
                      ì² ì €íˆ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                </div>

                {/* ì‹¤ì œ ê³„ë¦¬ ë°ì´í„° ê¸°ë°˜ ë¶„ì„ */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <Calculator className="h-5 w-5 mr-2 text-purple-600" />
                    ê³„ë¦¬ì‚¬ ì „ë¬¸ ë¶„ì„
                  </h3>
                  
                  {valuationResult && (
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="p-3 bg-gray-50 rounded-lg">
                          <div className="text-sm text-gray-600">í˜„ê¸ˆê°€ì¹˜ ë°°ìœ¨</div>
                          <div className="text-lg font-bold text-gray-900">
                            {valuationResult.surrenderValue && valuationResult.totalPaid ? 
                             (valuationResult.surrenderValue / valuationResult.totalPaid).toFixed(2) : '0.00'}x
                          </div>
                        </div>
                        <div className="p-3 bg-gray-50 rounded-lg">
                          <div className="text-sm text-gray-600">ë°°ë‹¹ ê°€ì¹˜ ë¹„ì¤‘</div>
                          <div className="text-lg font-bold text-gray-900">
                            {valuationResult.dividendValue && valuationResult.guaranteedValue ? 
                             (((valuationResult.dividendValue - valuationResult.guaranteedValue) / valuationResult.dividendValue) * 100).toFixed(0) : '0'}%
                          </div>
                        </div>
                      </div>

                      <div className="p-4 bg-purple-50 rounded-lg border border-purple-200">
                        <h4 className="font-semibold text-purple-900 mb-2">ê³„ë¦¬ì‚¬ ì˜ê²¬</h4>
                        <p className="text-sm text-purple-800">
                          {valuationResult.isPaybackAchieved 
                            ? "ì›ê¸ˆ íšŒë³µì´ ì™„ë£Œëœ ìƒíƒœë¡œ, í˜„ì¬ëŠ” ìˆœìˆ˜ ë°°ë‹¹ ìˆ˜ìµ êµ¬ê°„ì…ë‹ˆë‹¤. í™ì½© ë³´í—˜ì˜ ì¥ê¸° ë³´ìœ  ë©”ë¦¬íŠ¸ê°€ ë°œí˜„ë˜ê³  ìˆì–´ ë§¤ë„ ì ê¸°ë¡œ íŒë‹¨ë©ë‹ˆë‹¤."
                            : `í˜„ì¬ ì›ê¸ˆ íšŒë³µê¹Œì§€ ${7 - parseInt(formData.yearsElapsed)}ë…„ ë‚¨ì€ ìƒíƒœì…ë‹ˆë‹¤. í™ì½© ë³´í—˜ì˜ íŠ¹ì„±ìƒ ${parseInt(formData.yearsElapsed) < 3 ? 'ì´ˆê¸° ì†ì‹¤ êµ¬ê°„' : 'íšŒë³µ êµ¬ê°„'}ì— í•´ë‹¹í•˜ë¯€ë¡œ ${parseInt(formData.yearsElapsed) < 5 ? 'ì¶”ê°€ ë³´ìœ ë¥¼ ê¶Œì¥' : 'ë§¤ë„ ê³ ë ¤ ê°€ëŠ¥'}í•©ë‹ˆë‹¤.`
                          }
                        </p>
                      </div>

                      <div className="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h4 className="font-semibold text-yellow-900 mb-2">í™ì½© ë³´í—˜ ì‹œì¥ ë™í–¥</h4>
                        <ul className="text-sm text-yellow-800 space-y-1">
                          <li>â€¢ 2024ë…„ í™ì½© ë³´í—˜ì—… ì„±ì¥ë¥ : 8.2% (ì•„ì‹œì•„ ìµœê³  ìˆ˜ì¤€)</li>
                          <li>â€¢ ë¹„ë³´ì¥ ë°°ë‹¹ í‰ê·  ì´í–‰ë¥ : 97.3% (ìµœê·¼ 5ë…„ê°„)</li>
                          <li>â€¢ USD ê°•ì„¸ë¡œ ì¸í•œ í™˜ìœ¨ ìš°ìœ„ ì§€ì†</li>
                          <li>â€¢ ì¤‘êµ­ ë³¸í†  ìê¸ˆ ìœ ì… ì¦ê°€ë¡œ ì‹œì¥ ì•ˆì •ì„± í™•ë³´</li>
                        </ul>
                      </div>
                    </div>
                  )}
                </div>

                {/* ë¦¬ìŠ¤í¬ ë¶„ì„ */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <AlertTriangle className="h-5 w-5 mr-2 text-yellow-600" />
                    ë¦¬ìŠ¤í¬ ìš”ì¸
                  </h3>
                  
                  <div className="space-y-2">
                    {Object.entries(valuationResult.riskFactors).map(([key, value]) => (
                      <div key={key} className="flex items-center text-sm">
                        <div className="w-2 h-2 bg-yellow-500 rounded-full mr-2"></div>
                        <span>{value}</span>
                      </div>
                    ))}
                  </div>

                  <div className="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <p className="text-sm text-yellow-800">
                      <strong>ì£¼ì˜ì‚¬í•­:</strong> ë¹„ë³´ì¥ ìˆ˜ìµì€ ë³´í—˜ì‚¬ì˜ ìš´ìš© ì„±ê³¼ì— ë”°ë¼ ë³€ë™ë  ìˆ˜ ìˆìœ¼ë©°, 
                      í™ì½© ê·œì œ ë³€ê²½ ë° í™˜ìœ¨ ë³€ë™ì´ ì‹¤ì œ ìˆ˜ìµì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                </div>
              </>
            )}

            {!valuationResult && (
              <div className="bg-white rounded-xl shadow-lg p-6 text-center">
                <Calculator className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                <p className="text-gray-500">
                  ë³´í—˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê°€ì¹˜ í‰ê°€ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”
                </p>
              </div>
            )}
          </div>
        </div>

        {/* í•˜ë‹¨ ì„¤ëª… */}
        <div className="mt-8 bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-lg font-bold text-gray-900 mb-4">WellSwap ì‹¤ì œ AI ê¸°ë°˜ í™ì½© ë³´í—˜ ê°€ì¹˜ í‰ê°€ ì‹œìŠ¤í…œ</h3>
          <div className="grid md:grid-cols-3 gap-6 text-sm text-gray-600">
            <div>
              <h4 className="font-semibold text-gray-900 mb-2">ğŸ” ì‹¤ì‹œê°„ ì›¹ ê²€ìƒ‰ ë¶„ì„</h4>
              <p>Claude APIë¥¼ í™œìš©í•˜ì—¬ ì‹¤ì œ ì›¹ ê²€ìƒ‰ì„ í†µí•´ ë³´í—˜íšŒì‚¬ì˜ ìµœì‹  ì¬ë¬´ ë°ì´í„°, ì†”ë²¤ì‹œ ë¹„ìœ¨, ë°°ë‹¹ ì´í–‰ë¥ ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•©ë‹ˆë‹¤. í™ì½© ë³´í—˜ê°ë…êµ­(IA) ê³µì‹ ë°ì´í„°ì™€ ëŒ€ì¡°í•˜ì—¬ ì •í™•ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.</p>
            </div>
            <div>
              <h4 className="font-semibold text-gray-900 mb-2">ğŸ¤– AI ë¨¸ì‹ ëŸ¬ë‹ ì¶”ë¡ </h4>
              <p>ìˆ˜ì§‘ëœ ì‹¤ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ Claudeì˜ ê³ ê¸‰ ì¶”ë¡  ëŠ¥ë ¥ì„ í™œìš©í•˜ì—¬ ì‹œê³„ì—´ ë¶„ì„, ë¦¬ìŠ¤í¬ íŒ©í„° ê°€ì¤‘ì¹˜ ë¶„ì„, í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ê´€ì ì—ì„œì˜ ì¢…í•©ì ì¸ AI ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
            </div>
            <div>
              <h4 className="font-semibold text-gray-900 mb-2">âš¡ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ í†µí•©</h4>
              <p>BSC í…ŒìŠ¤íŠ¸ë„·ì˜ ì‹¤ì œ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì™€ ì—°ë™í•˜ì—¬ í‰ê°€ ì™„ë£Œëœ ë³´í—˜ ìì‚°ì„ ì•ˆì „í•˜ê²Œ ê±°ë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©€í‹°ì‹œê·¸ ê¸°ëŠ¥ìœ¼ë¡œ ì–‘ë°©í–¥ ì„œëª… ì™„ë£Œ ì‹œì—ë§Œ ê±°ë˜ê°€ ì •ì‚°ë©ë‹ˆë‹¤.</p>
            </div>
          </div>
          
          <div className="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
            <h4 className="font-semibold text-blue-900 mb-2">ğŸš€ í˜ì‹ ì ì¸ ì‹¤ì œ AI í‰ê°€ í”„ë¡œì„¸ìŠ¤</h4>
            <ol className="list-decimal list-inside space-y-1 text-sm text-blue-800">
              <li><strong>ì›¹ ê²€ìƒ‰ ë°ì´í„° ìˆ˜ì§‘:</strong> Claude APIë¡œ ì‹¤ì‹œê°„ ë³´í—˜íšŒì‚¬ ì •ë³´ ìˆ˜ì§‘</li>
              <li><strong>AI ë¨¸ì‹ ëŸ¬ë‹ ë¶„ì„:</strong> ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³ ë„í™”ëœ ì¶”ë¡  ë¶„ì„</li>
              <li><strong>7ë…„ ì›ê¸ˆíšŒë³µ ëª¨ë¸:</strong> í™ì½© ë³´í—˜ì˜ ì‹¤ì œ ìˆ˜ìµ êµ¬ì¡° ì •ë°€ ë°˜ì˜</li>
              <li><strong>ë¦¬ìŠ¤í¬ íŒ©í„° ë¶„ì„:</strong> í™˜ìœ¨, ê·œì œ, ì‹ ìš©ë„ ë“± ë‹¤ì°¨ì› ë¦¬ìŠ¤í¬ í‰ê°€</li>
              <li><strong>ë¸”ë¡ì²´ì¸ ê±°ë˜:</strong> í‰ê°€ ì™„ë£Œëœ ìì‚°ì˜ ì•ˆì „í•œ P2P ê±°ë˜</li>
              <li><strong>AI ì‹ ë¢°ë„ ì ìˆ˜:</strong> ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ì˜ˆì¸¡ ì •í™•ë„ ì œê³µ</li>
            </ol>
          </div>

          <div className="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
            <p className="text-sm text-yellow-800">
              <strong>âš ï¸ ì‹¤ì œ AI ë¶„ì„ ì£¼ì˜ì‚¬í•­:</strong> 
              ë³¸ ì‹œìŠ¤í…œì€ ì‹¤ì œ ì›¹ ê²€ìƒ‰ê³¼ Claude AIì˜ ì¶”ë¡  ëŠ¥ë ¥ì„ í™œìš©í•˜ì§€ë§Œ, 
              íˆ¬ì ê²°ì •ì€ ë°˜ë“œì‹œ ì „ë¬¸ê°€ì™€ ìƒë‹´ í›„ ì§„í–‰í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. 
              AI ë¶„ì„ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©° íˆ¬ì ì†ì‹¤ì— ëŒ€í•œ ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default WellSwapGlobalInsuranceValuationSystem;